---
title: パスキー認証を試す
description: ""
---

import {
  Aside,
  Card,
  Code,
  FileTree,
  TabItem,
  Tabs,
} from "@astrojs/starlight/components";

## プログラムの起動

まずはローカル環境で動作を確認してみましょう。

環境変数を設定します。 `backend/.env` ファイルを作成し、以下の内容を記述してください。

```
RP_ID = "localhost"
EXPECTED_ORIGIN = "http://localhost:5173"
```

あるいは、同梱している `backend/.env.example` をリネームしてください。

<FileTree>
- backend/
    - **.env.example**

</FileTree>

ファイルを作成したら、 WebAuthn サーバを起動します。

<Tabs>
  <TabItem label="pip">
    <Code
      lang="bash"
      code={`cd backend
python poc.py`}
    ></Code>
  </TabItem>
  <TabItem label="uv">
    <Code
      lang="bash"
      code={`cd backend
uv run poc.py`}
    ></Code>
  </TabItem>
</Tabs>

Python 標準ライブラリに同梱されている `http.server` を利用し、フロントエンドを起動します。

<Tabs>
  <TabItem label="default">
    <Code
      lang="bash"
      code={`cd frontend/1_basic_flow
python -m http.server 5173 --directory .`}
    ></Code>
  </TabItem>
  <TabItem label="uv">
    <Code
      lang="bash"
      code={`cd frontend/1_basic_flow
uv run -m http.server 5173 --directory .`}
    ></Code>
  </TabItem>
</Tabs>

ブラウザで [http://localhost:5173](http://localhost:5173) にアクセスします。
ページが表示されていれば OK です。

## 認証鍵の登録

では認証鍵を登録してみましょう。 `🚪 Register` を押してみてください。
Chrome からパスキーの作成が求められるので、認証鍵を保存します。完了すると `Authenticator registered!` と表示されます。

保存が完了したら、 [chrome://password-manager/passwords](chrome://password-manager/passwords) にアクセスします。
ドメインごとに保存した認証情報を確認することができます。

期待動作として、 `localhost` ドメインに対して本日の日付で認証情報が保存されていることが確認できます。

<Aside>
  `poc.py`
  の実装では、メモリ上に認証情報を保存しています。サーバを再起動ないし終了すると、登録した認証情報は失われます。
</Aside>

## 認証処理の実行

アプリケーションからそのまま `🔐 Authenticate` を押してください。現時点では固定のユーザで認証を行うため、そのまま認証処理が実行されます。

認証処理が成功すれば `User authenticated!` と表示されます。

<Aside>
  認証鍵の登録と認証処理が同一ページで行えてしまいますが、一般的には別ページで行います。
</Aside>
